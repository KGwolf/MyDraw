<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36" version="26.1.3">
  <diagram name="第 1 页" id="bNRUMGfdpHtpgNB-Gve9">
    <mxGraphModel dx="2876" dy="2235" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="2RxM4l89XDD24nxAgFgx-1" value="Nacos：客户端、服务端。服务端是一个Spring Boot的Web服务。&lt;div&gt;服务注册与发现：&lt;/div&gt;&lt;div&gt;心跳机制、续约：&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=18;verticalAlign=top;align=left;" parent="1" vertex="1">
          <mxGeometry x="-130" y="140" width="420" height="220" as="geometry" />
        </mxCell>
        <mxCell id="2RxM4l89XDD24nxAgFgx-2" value="&lt;div&gt;OpenFeign：&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;架构图&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;优化&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;配置&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;源码：@EnableFeginClents会导入一个FeignClientsRegistrar 类，这个类会去扫描指定路径（不写默认当前类的包路径），带有@FeginClient的接口，然后生成对应的FacotryBean 的beanDefiniton，在Spring启动执行的时候，&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;根据属性设置&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;创建对应的代理对象，在调用方法的时候，走代理方法的逻辑。&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=18;verticalAlign=top;align=left;" parent="1" vertex="1">
          <mxGeometry x="407" y="140" width="543" height="300" as="geometry" />
        </mxCell>
        <mxCell id="2RxM4l89XDD24nxAgFgx-3" value="Our Project Maven Dependency：&lt;div&gt;&lt;div&gt;&amp;lt;properties&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;java.version&amp;gt;1.8&amp;lt;/java.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;maven.compiler.source&amp;gt;${java.version}&amp;lt;/maven.compiler.source&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;maven.compiler.target&amp;gt;${java.version}&amp;lt;/maven.compiler.target&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;project.build.sourceEncoding&amp;gt;UTF-8&amp;lt;/project.build.sourceEncoding&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;project.reporting.outputEncoding&amp;gt;UTF-8&amp;lt;/project.reporting.outputEncoding&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;spring-boot.version&amp;gt;2.7.18&amp;lt;/spring-boot.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;spring-cloud.version&amp;gt;2021.0.8&amp;lt;/spring-cloud.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;spring-cloud-alibaba.version&amp;gt;2021.0.5.0&amp;lt;/spring-cloud-alibaba.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;alibaba.nacos.version&amp;gt;2.2.2&amp;lt;/alibaba.nacos.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;commons-collections4.version&amp;gt;4.4&amp;lt;/commons-collections4.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;commons-beanutils.version&amp;gt;1.9.4&amp;lt;/commons-beanutils.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;jjwt.version&amp;gt;0.9.1&amp;lt;/jjwt.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;druid.version&amp;gt;1.2.16&amp;lt;/druid.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;spring-boot.mybatis&amp;gt;2.3.2&amp;lt;/spring-boot.mybatis&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;mybatis.version&amp;gt;3.5.16&amp;lt;/mybatis.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;mybatis-plus.version&amp;gt;3.5.7&amp;lt;/mybatis-plus.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;dynamic-ds.version&amp;gt;4.3.1&amp;lt;/dynamic-ds.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;pagehelper.boot.version&amp;gt;2.1.0&amp;lt;/pagehelper.boot.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;redisson.version&amp;gt;3.20.1&amp;lt;/redisson.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;easy-captcha.version&amp;gt;1.6.2&amp;lt;/easy-captcha.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;hutool.version&amp;gt;5.8.29&amp;lt;/hutool.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;easypoi.version&amp;gt;4.4.0&amp;lt;/easypoi.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;poi.version&amp;gt;4.1.2&amp;lt;/poi.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;compress.version&amp;gt;1.21&amp;lt;/compress.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;spring-boot-admin.version&amp;gt;2.7.10&amp;lt;/spring-boot-admin.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;commons-configuration2.version&amp;gt;2.7&amp;lt;/commons-configuration2.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;userAgent.version&amp;gt;1.21&amp;lt;/userAgent.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;transmittable.version&amp;gt;2.14.2&amp;lt;/transmittable.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;commons-io.version&amp;gt;2.7&amp;lt;/commons-io.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;servlet-api.version&amp;gt;4.0.1&amp;lt;/servlet-api.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;guava.version&amp;gt;32.0.1-jre&amp;lt;/guava.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;mapstruct.version&amp;gt;1.5.5.Final&amp;lt;/mapstruct.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;bcprov.version&amp;gt;1.76&amp;lt;/bcprov.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;jedis-mock.version&amp;gt;1.0.5&amp;lt;/jedis-mock.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;podam.version&amp;gt;7.2.11.RELEASE&amp;lt;/podam.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;tinypinyin.version&amp;gt;2.0.3.RELEASE&amp;lt;/tinypinyin.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;sqlite.version&amp;gt;3.46.0.0&amp;lt;/sqlite.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;sqlite-jdbc-crypt.version&amp;gt;3.46.0.0&amp;lt;/sqlite-jdbc-crypt.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;h2.version&amp;gt;2.2.224&amp;lt;/h2.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;jasypt.version&amp;gt;3.0.5&amp;lt;/jasypt.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;p6spy.version&amp;gt;3.9.1&amp;lt;/p6spy.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;oshi.version&amp;gt;6.6.1&amp;lt;/oshi.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;QLExpress.version&amp;gt;3.3.3&amp;lt;/QLExpress.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;cglib.version&amp;gt;3.3.0&amp;lt;/cglib.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;vfs2.version&amp;gt;2.7.0&amp;lt;/vfs2.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;clickhouse.version&amp;gt;0.5.0&amp;lt;/clickhouse.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;kettle.version&amp;gt;9.2.0.0-290&amp;lt;/kettle.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;cxf.version&amp;gt;3.5.5&amp;lt;/cxf.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;lock4j.version&amp;gt;2.2.5&amp;lt;/lock4j.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;caffeine.version&amp;gt;2.9.3&amp;lt;/caffeine.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;freemarker.version&amp;gt;2.3.32&amp;lt;/freemarker.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;doc-pl.version&amp;gt;1.10.5&amp;lt;/doc-pl.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;batik.version&amp;gt;1.17&amp;lt;/batik.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;easyexcel.version&amp;gt;3.3.1&amp;lt;/easyexcel.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;dom4j.version&amp;gt;2.1.4&amp;lt;/dom4j.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;disruptor.version&amp;gt;3.4.4&amp;lt;/disruptor.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;socketio.version&amp;gt;1.7.19&amp;lt;/socketio.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;fileupload.version&amp;gt;1.5&amp;lt;/fileupload.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;jndi.version&amp;gt;1.0.3&amp;lt;/jndi.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;javax.mail.version&amp;gt;1.6.2&amp;lt;/javax.mail.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;jpinyin.version&amp;gt;1.1.8&amp;lt;/jpinyin.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;tlog.version&amp;gt;1.5.1&amp;lt;/tlog.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;javatuples.version&amp;gt;1.2&amp;lt;/javatuples.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;satoken.version&amp;gt;1.39.0&amp;lt;/satoken.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;snakeyaml.version&amp;gt;2.0&amp;lt;/snakeyaml.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;xxl-job.version&amp;gt;2.4.0&amp;lt;/xxl-job.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;zxing.version&amp;gt;3.5.2&amp;lt;/zxing.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;jsqlparser.version&amp;gt;4.9&amp;lt;/jsqlparser.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;zip4j.version&amp;gt;2.11.5&amp;lt;/zip4j.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;shedlock.version&amp;gt;4.44.0&amp;lt;/shedlock.version&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;kingbase.version&amp;gt;8.6.0&amp;lt;/kingbase.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;pgsql.version&amp;gt;42.6.0&amp;lt;/pgsql.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;lt;dameng.version&amp;gt;8.1.3.62&amp;lt;/dameng.version&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;lt;/properties&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=18;verticalAlign=top;align=left;" parent="1" vertex="1">
          <mxGeometry x="-190" y="510" width="800" height="1690" as="geometry" />
        </mxCell>
        <mxCell id="8Nu4Ka4w16lwiklZhjRO-1" value="微服务架构演进：&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;单体：一个jar包，一台服务器运行&lt;/div&gt;&lt;div&gt;垂直：拆分业务，不同的项目，打不同的jar包。&lt;/div&gt;&lt;div&gt;SOA：也是拆分成服务，服务之间的通信有统一的规则，比如ESB企业服务总线来管理服务之间的依赖。webservice也算SOA的一种实现。&lt;/div&gt;&lt;div&gt;微服务：粒度更小的服务。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;版本选择：https://github.com/alibaba/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=18;verticalAlign=top;align=left;" parent="1" vertex="1">
          <mxGeometry x="-70" y="-260" width="1050" height="280" as="geometry" />
        </mxCell>
        <mxCell id="JkpguMBfyvvDvHadpzbC-1" value="&lt;div&gt;负载均衡算法：可以用在&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;轮询、加权轮询、随机、加权随机、最少连接、IP哈希、一致性哈希等&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=18;verticalAlign=top;align=left;" parent="1" vertex="1">
          <mxGeometry x="1080" y="150" width="580" height="220" as="geometry" />
        </mxCell>
        <mxCell id="VfdaiQWPS9US5twS7hE0-1" value="&lt;div&gt;哈希算法：应用在负载均衡、缓存数据分区等场景。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;普通哈希：通过哈希函数得到一个散列值，然后 跟机器数量取模运算，得到一个索引值。然后根据索引值找到对应机器，分发请求、或者读写数据。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;一致性哈希：是一个环形的结构，分成了 2的32次方个节点，然后把服务器映射到这个环形结构中的一个节点（通过服务器ip地址进行hash运算，对 2的32次方取模）。 然后再把传过来的key值，进行哈希运算，同样对 2的32次方取模，得到一个值，然后顺时针方向找到第1个服务器。这个服务器就是我们一致性哈希得到的结果。&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;问题：1.集群的缩容和扩容：普通的哈希算法，因为分母变了，那么原来落在机器上的很多数据都变化了，要么就需要迁移很多数据，要么负载均衡选择的机器也变了。&amp;nbsp; 而一致性哈希算法，只需要修改新加的机器到上一台机器的中间环形结构上的数据，不影响其它的，影响相比较少了很多很多。&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;2.数据倾斜的问题：很有可能很多key过来哈希之后都弄到同一个节点上面去了，所以解决这个问题，需要引入虚拟节点，在A和B服务器之间，中间穿插很多的A、B、C和其他服务器的节点。 这样能分摊很多倾斜的数据。&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=18;verticalAlign=top;align=left;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1080" y="420" width="610" height="440" as="geometry" />
        </mxCell>
        <mxCell id="VfdaiQWPS9US5twS7hE0-2" value="Spring Boot 中使用数据库：" style="rounded=0;whiteSpace=wrap;html=1;fontSize=18;verticalAlign=top;align=left;" parent="1" vertex="1">
          <mxGeometry x="760" y="1080" width="480" height="280" as="geometry" />
        </mxCell>
        <mxCell id="llbknPpr0wl2aexQ5wte-1" value="Sentinal：&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;服务端（控制台界面）增删改查限流、熔断等规则后，推送给客户端内存里面（需要自己去做持久化，可以nacos配置中心）。然后客户端的源码，大体就是：try catch包住全部的逻辑，然后请求通过一个责任链模式，有很多的slot，如果不符合规则条件判断，就会抛出异常（分为block异常和程序自己的逻辑异常），捕捉到之后分别执行不同的方法。 复杂的是里面的各种算法，比如滑动窗口。&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Sentinal分布式环境的限流，开源的版本其实是没有提供这个实现的，但是官网给出了架构图，可以自己实现，也可以用他们的云产品。主要还是为了多卖钱。&lt;/div&gt;&lt;div&gt;还有持久化也是需要自己来做的，拉模式和推模式。（需要看源码的扩展点，拉模式，可以持久化到文件、mysql中，推模式可以持久化到nacos、zk）&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;责任链模式很多中间件里面都有用到吧：Sentinal&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=18;verticalAlign=top;align=left;" parent="1" vertex="1">
          <mxGeometry x="1710" y="980" width="490" height="400" as="geometry" />
        </mxCell>
        <mxCell id="UeN3P7YvOwQrCzJwxY_4-1" value="限流算法的演进：&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;普通的redis或者其他的计数算法，只能统计固定的一个时间间隔，&lt;font style=&quot;color: rgb(255, 0, 0);&quot;&gt;固定窗口&lt;/font&gt;，比如1分钟的统计，从00:00到00:01的qps数量。 这样的统计其实是不精确的，&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;它不是统计的一个可移动的时间间隔，&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;会有&lt;/span&gt;&lt;font style=&quot;background-color: transparent; color: rgb(255, 0, 0);&quot;&gt;流量临界突刺&lt;/font&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;的问题：流量集中在前一个时间间隔的后半部分 和 后一个时间间隔的前半部分，这种情况在这2个时间间隔内都不会进行限流，但是在后一个时间间隔的中间开始看，其实是超过了限流的阈值了的。我们想要的效果是：&lt;/span&gt;&lt;font style=&quot;background-color: transparent; color: rgb(255, 0, 0);&quot;&gt;这个请求进入系统的这个时间节点，往前面一分钟的这个时间间隔的qps数量&lt;/font&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;。这个效果就是 &lt;/span&gt;&lt;font style=&quot;background-color: transparent; color: rgb(255, 0, 0);&quot;&gt;滑动窗口&lt;/font&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;。&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=18;verticalAlign=top;align=left;" parent="1" vertex="1">
          <mxGeometry x="1720" y="1420" width="480" height="280" as="geometry" />
        </mxCell>
        <mxCell id="YG4GrdYwy3NGrYMXa4sz-1" value="滑动窗口还有时钟回拨的问题，但是只是一个判断，加上返回一个new 节点。不会做什么额外的处理。&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;sentinel限流的3种流控模式和3种流控效果：&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;模式：直接模式、关联模式、链路模式。&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;效果：快速失败（滑动窗口算法）、Warm Up（预热模式，令牌桶算法）、排队等待（匀速排队，漏桶算法）&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=18;verticalAlign=top;align=left;" parent="1" vertex="1">
          <mxGeometry x="1720" y="1730" width="480" height="280" as="geometry" />
        </mxCell>
        <mxCell id="xb5FwsVI7nqsQViI3kiX-1" value="Nacos使用的时候不需要在类上面加注解，而OpenFeign需要加上@EnableFeginClients" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="210" y="50" width="250" height="50" as="geometry" />
        </mxCell>
        <mxCell id="lFDamCLCkBhxT8NYs803-1" value="&lt;div&gt;分布式事务：Seata&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Seata提供了几种模式：AT、TCC、SAGA和XA事务模式。首推AT模式，这种对业务代码侵入少，性能比XA好。TCC性能比AT好，但是业务代码侵入强。&lt;/div&gt;&lt;div&gt;这些都是基于两阶段提交的。&lt;/div&gt;&lt;div&gt;ZK里面的ZAB协议实现的时候，是类似两阶段提交，不是严格意义上的。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2PC存在什么问题？AT模式是怎么解决的呢？&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;两阶段提交是算法，XA是具体的一个协议。所以说XA是2pc的一种实现。&lt;/div&gt;&lt;div&gt;主流的关系型数据库基本都实现了XA协议：mysql、pgsql、oracle、sqlserver等。xa在数据库中。&lt;/div&gt;&lt;div&gt;XA不局限于数据库中，有些消息队列也实现了XA的：RabbitMQ、ActiveMQ。还有MongDB 4.0+版本也实现了XA。 但是Redis、kafka、rocketmq这些不支持xa，rocketmq本身支持事务消息。 redis、kafka等可能需要用到TCC\Saga等。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;XA会占用数据库的连接，也就是说要么事务成功提交，要么回滚之后才会释放连接资源。那么shardingjdbc就是用的XA来实现分布式事务的吗？&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;AT模式，不会占用资源，只会用一把类似分布式锁来实现后续的自动回滚（别的事务操作不了这个事务当前占有的数据行。通过前置镜像和后置镜像（类似插入事务前的sql语句？）来实现事务的回滚）。但是效率上来说有点点低，因为要往数据库中插入很多行。不会对业务代码有侵入性。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;TCC模式，代码侵入性高，需要自己在业务中去实现补偿操作。&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=18;verticalAlign=top;align=left;" parent="1" vertex="1">
          <mxGeometry x="2470" y="1510" width="780" height="530" as="geometry" />
        </mxCell>
        <mxCell id="gp-tOEH7vBiZSUj95nvB-3" value="&lt;div&gt;网关GateWay：&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;单纯的路由转发不需要做什么，pom添加gatewat、nacos的包。排除掉mvc相关的包，因为gateway底层是webflux来做的。跟mvc有冲突。 然后就是配置nacos和gateway的规则（路由断言）&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;结合Sentinal限流来做的。&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=18;verticalAlign=top;align=left;" parent="1" vertex="1">
          <mxGeometry x="2330" y="2070" width="780" height="530" as="geometry" />
        </mxCell>
        <mxCell id="gp-tOEH7vBiZSUj95nvB-4" value="&lt;div&gt;Arthas+Prometheus+Grafana的使用，和线上如何搭建一个监控系统：&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=18;verticalAlign=top;align=left;" parent="1" vertex="1">
          <mxGeometry x="1370" y="2120" width="780" height="530" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
