<mxfile host="app.diagrams.net" modified="2023-03-27T14:07:55.756Z" agent="5.0 (Macintosh; Intel Mac OS X 10_15_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.139 Safari/537.36" etag="JgD7kPWrDi-yMKBbBNsD" version="21.0.10" type="github">
  <diagram name="第 1 页" id="j0T0W_XY4i96COsHRtta">
    <mxGraphModel dx="2868" dy="1548" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="gD5YT0Y3-eSmoMF3_J99-2" value="一开始load的时候类型是GenericBeanDefinition&lt;br&gt;&lt;br&gt;通过getMergedLocalBeanDefinition()方法合并了父类的beanDefinition后，类型变成了RootBeanDefinition&lt;br&gt;&lt;br&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=22;" parent="1" vertex="1">
          <mxGeometry x="1350" y="1780" width="470" height="230" as="geometry" />
        </mxCell>
        <mxCell id="wJDUlHO4tCs9Kh0-4UFC-2" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1330" y="420" width="1260" height="1030" as="geometry" />
        </mxCell>
        <mxCell id="BxTBeL077zcQ3UxvTALr-2" value="&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;# Spring&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br style=&quot;border-color: var(--border-color);&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br style=&quot;border-color: var(--border-color);&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br style=&quot;border-color: var(--border-color);&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;核心就是refresh方法&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br style=&quot;border-color: var(--border-color);&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br style=&quot;border-color: var(--border-color);&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br style=&quot;border-color: var(--border-color);&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;1.prepareRefresh：给上下文赋一些初始值。做准备工作。&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br style=&quot;border-color: var(--border-color);&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br style=&quot;border-color: var(--border-color);&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br style=&quot;border-color: var(--border-color);&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color);&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;2.&lt;/span&gt;&lt;b style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 22px;&quot;&gt;obtainFreshBeanFactory&lt;/font&gt;&lt;/b&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;：创建一个DefaultListableBeanFactory。加载BeanDefinition，其中loadBeanDefinitions()，有很多重载，直到doLoadBeanDefinitions()，加载配置文件，registerBeanDefinitions()，再doRegisterBeanDefinitions()，再parseBeanDefinitions()，这里2个分支，parseDefaultElement()，parseCustomElement()，一个是默认标签，一个是自定义标签。最终是给2个地方赋值：beanDefinitionMap（一个Map集合），beanDefinitionNames（一个存放名字的集合）。&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br style=&quot;border-color: var(--border-color);&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px; border-color: var(--border-color);&quot;&gt;其中parseCustomElement()，除了进行自己定义的标签会处理，如果还有&amp;lt;compent-scan&amp;gt;标签，进行处理：parseCustomElement()，通过&lt;/font&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;scanner.doScan(包路径),，先根据路径找到路径下面的所有文件（类文件），然后看看是否有对应的注解（@Component，@Service等），找到则加入BeanDefinitionMap和name。同时调用&lt;/span&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;registerComponents()方法，进行&lt;/font&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;组件注册（包括注册一些内部的注解后置处理器，触发注册事件）：&lt;/font&gt;ConfigurationClassPostProcessor、AutowiredAnnotationBeanPostProcessor、CommonAnnotationBeanPostProcessor等，将这几个一起加入到BeanDefinitionMap中。&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;3.&lt;/span&gt;&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;prepareBeanFactory：给BeanFactory赋一些初始值，&lt;/span&gt;&lt;b style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 22px;&quot;&gt;向BeanFactory中添加一些BeanPostProcessor，&lt;/font&gt;&lt;/b&gt;&lt;/font&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;ignoreDependencyInterface&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;registerResolvableDependency。&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;4.postProcessBeanFactory：可以注册一些特殊的BeanPostProcessors,默认没有实现，丢给子类去进行扩展，比如Spring Mvc。&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;5.&lt;/span&gt;&lt;b style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 22px;&quot;&gt;invokeBeanFactoryPostProcessors&lt;/font&gt;&lt;/b&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;：调用各种的BFPP，创建BFPP类。&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;blockquote style=&quot;margin: 0 0 0 40px; border: none; padding: 0px;&quot;&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;一：在BeanDefinationMap 中查找有没有BeanDefinitionRegistryPostProcessor类型的BeanName&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;1.匹配实现了&lt;/font&gt;PriorityOrdered接口的&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;2.匹配实现了Ordered接口的&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;3.匹配都没有实现的&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;匹配到了之后，&lt;/span&gt;&lt;b style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;调用beanFactory.getBean()来&lt;/span&gt;&lt;font style=&quot;font-size: 25px;&quot;&gt;创建BFPP对象&lt;/font&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;，并且调用对象的postProcessBeanDefinitionRegistry()方法，这个方法的作用大概就是增强BeanDefinition，给它赋值一些其它的东西。&lt;/span&gt;&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;举个例子：我们之前loadBeanDefinition的时候，有注册过一个组件&lt;/font&gt;internalConfigurationAnnotationProcessor，它的对象类型是ConfigurationClassPostProcessor，实现了BeanDefinitionRegistryPostProcessor接口，所以会调用这个类的postProcessBeanDefinitionRegistry()方法，它里面的实现作用主要是：&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;在beanDefinition中找到有注解的类，然后去处理@PropertySource、@ComponentScan、@Import、@ImportResource、@Bean&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;处理的结果就是给beanDefinitaion赋值，或者给环境变量增加值等。&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;二：在BeanDefinitionMap中查找有没有BeanFactoryPostProcessor类型的BeanName。步骤跟上面的第一步类似，只不过这种多是我们&lt;b&gt;自己定义的BFPP类。&lt;/b&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br style=&quot;border-color: var(--border-color);&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color);&quot;&gt;&lt;font style=&quot;font-size: 18px; border-color: var(--border-color);&quot;&gt;6.&lt;/font&gt;&lt;b style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 22px;&quot;&gt;registerBeanPostProcessors&lt;/font&gt;&lt;/b&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;：注册BPP。&lt;/span&gt;&lt;b style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 22px;&quot;&gt;创建BPP的对象，但是不会调用方法。&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;跟上面第5个方法invokeBeanFactoryPostProcessor类似，查找BeanDefinitionMap中有没有&lt;b&gt;实现BeanPostProcessor的BeanName&lt;/b&gt;。调用getBean()来创建实体，唯一不同的是，这里不会调用方法。&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;7.&lt;/span&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;initMessageSource&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;8.initApplicationEventMuliticaster&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;9.onRefresh&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;10.registerListeners&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;11.&lt;/span&gt;&lt;b style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 22px;&quot;&gt;finishBeanFactoryInitialization&lt;/font&gt;&lt;/b&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;：开始准备实例化对象。&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;调用preInstantiateSingletons()方法，判断是不是FactoryBean，如果是，看右边的流程。&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;如果不是，则走geBean()---&amp;gt;doGetBean()----&amp;gt;createBean()----&amp;gt;doCreateBean()的流程。&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;doGetBean()：&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;1.getSingleton()从缓存中取bean对象，如果没有就标记对象为创建中状态，判断是否是单例对象，如果是，就再getSingleton()，如果还是没有，就调用createBean()。&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;createBean()：&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;1.mbdToUse.prepareMethodOverrides()，设置一个状态位，跟lookup-method、override-method标签有关系。&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;2.resolveBeforeInstantiation()，&lt;/span&gt;&lt;b style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 22px;&quot;&gt;允许BPP返回一个代理对象&lt;/font&gt;&lt;/b&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;。如果创建成功，就直接返回了，创建对象结束！&lt;/span&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;3.doCreateBean()&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt; &lt;/span&gt;&lt;b style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 22px;&quot;&gt;doCreateBean()：&lt;/font&gt;&lt;/b&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;1.createBeanInstance()：根据beanname获取Class对象，判断是否是supplier或者factory-method，如果是，就走单独的创建实例流程返回。如果不是，&lt;b&gt;再判断选取一个合适的构造函数&lt;/b&gt;，过程较复杂，如果调用了instantiateBean，再getInstantiationStrategy().instantiate()，获取实例化策略，再进行实例化，最后返回一个实例化的对象，这个对象仅仅是实例化，并未进行初始化。&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;text-align: left;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;2.&lt;/font&gt;applyMergedBeanDefinitionPostProcessors()：&lt;/span&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;允许BPP去修改mergedBeanDefinition，&lt;/font&gt;&lt;font style=&quot;font-size: 18px; background-color: initial; border-color: var(--border-color);&quot;&gt;循环调用之前实例化的这些BeanPostProcessor的&lt;/font&gt;&lt;span style=&quot;font-size: 18px; background-color: initial;&quot;&gt;postProcessMergedBeanDefinition方法，&lt;b&gt;AOP也跟这里有关系？&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;span style=&quot;font-size: 18px; background-color: initial;&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;首先CommonAnnotationBeanPostProcessor类，调用ppMBD方法，会掉用父类InitDestroyAnnotationBeanPostProcessor的ppMBD方法，里面构建生命周期元数据，主要是&lt;b&gt;@PostConstruct和@PreDestroy&lt;/b&gt;注解的查找，然后再给BeanDefinition的属性赋值（externallyManagedInitMethods、externallyManagedDestroyMethods）。然后再调用findResourceMetadata()方法，查找@Resource注解，给externallyManagedConfigMembers属性赋值。&lt;span style=&quot;font-size: 18px; background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;其次，AutowiredAnnotationBeanPostProcessor类，调用ppMBD方法，findAutowiringMetadata()，查找&lt;b&gt;@Autowire和@Value&lt;/b&gt;注解，&lt;/span&gt;&lt;font style=&quot;font-size: 19px; background-color: initial;&quot;&gt;然后给&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;font style=&quot;font-size: 19px;&quot;&gt;externallyManagedConfigMembers属性赋值。&lt;/font&gt;&lt;br&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br style=&quot;border-color: var(--border-color);&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br style=&quot;border-color: var(--border-color);&quot;&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color);&quot;&gt;&lt;pre style=&quot;border-color: var(--border-color);&quot;&gt;&lt;b&gt;&lt;font style=&quot;font-size: 25px;&quot;&gt;populateBean():给实例化对象赋值。&lt;/font&gt;&lt;/b&gt;&lt;/pre&gt;&lt;pre style=&quot;border-color: var(--border-color);&quot;&gt;&lt;b&gt;&lt;font style=&quot;font-size: 25px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/b&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;font style=&quot;border-color: var(--border-color);&quot;&gt;3.如果是纯注解的方式，流程是怎么走的呢？怎么查找beandefinition的信息？look-up标签的效果如何用注解的方式来实现？&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: justify; border-color: var(--border-color); font-size: 18px;&quot;&gt;&lt;br style=&quot;border-color: var(--border-color);&quot;&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="80" y="420" width="1170" height="2960" as="geometry" />
        </mxCell>
        <mxCell id="3Tz9ayiB8aLOj15XIJGB-1" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;font-size: 18px; background-color: initial;&quot;&gt;parseDefaultElement()：包括了以下标签：&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;b&gt;&lt;span style=&quot;font-size: 18px; background-color: initial;&quot;&gt;IMPORT_ELEMENT、&lt;/span&gt;&lt;span style=&quot;font-size: 18px; background-color: initial;&quot;&gt;ALIAS_ELEMENT、&lt;/span&gt;&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;b&gt;&lt;span style=&quot;font-size: 18px; background-color: initial;&quot;&gt;BEAN_ELEMENT、&lt;/span&gt;&lt;span style=&quot;font-size: 18px; background-color: initial;&quot;&gt;NESTED_BEANS_ELEMENT&lt;/span&gt;&lt;/b&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1361" y="510" width="529" height="150" as="geometry" />
        </mxCell>
        <mxCell id="3Tz9ayiB8aLOj15XIJGB-2" value="&lt;pre style=&quot;font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;doScan是如何扫描的？&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;findCandidateComponents(包名)方法，&lt;/font&gt;首先找到包名下面的所有类文件，isCandidateComponent方法判断是否是组件，&lt;/pre&gt;&lt;pre style=&quot;font-size: 18px;&quot;&gt;其实就是看类上面的注解是否有@Component，像@Service等这种，其实也是继承了@Component注解的，都算。&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="1351" y="700" width="1029" height="120" as="geometry" />
        </mxCell>
        <mxCell id="3Tz9ayiB8aLOj15XIJGB-3" value="&lt;pre style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;registerComponents：注册组件&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;&quot;&gt;&lt;pre style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;registerAnnotationConfigProcessors()方法，就是判断BeanFactory里面的BeanDefinition里面有没有那些beanname，&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;如果没有，就调用registerPostProcessor()方法，注册进入BeanDefinition里面。&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;beandefinitionsMap加入如下信息：&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;internalConfigurationAnnotationProcessor---&amp;gt;ConfigurationClassPostProcessor&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;&quot;&gt;&lt;pre style=&quot;font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;internalAutowiredAnnotationProcessor    ---&amp;gt;&lt;/font&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;AutowiredAnnotationBeanPostProcessor&lt;/font&gt;&lt;span style=&quot;font-size: 13px;&quot;&gt;    &lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;&quot;&gt;&lt;pre style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;internalCommonAnnotationProcessor       ---&amp;gt;&lt;/span&gt;&lt;b style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 22px;&quot;&gt;CommonAnnotationBeanPostProcessor(这个很重要，后面有用到！)&lt;/font&gt;&lt;/b&gt;&lt;/pre&gt;&lt;pre style=&quot;font-size: 18px;&quot;&gt;&lt;pre style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial; font-family: Helvetica; white-space: normal;&quot;&gt;internalEventListenerProcessor&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ---&amp;gt;EventListenerMethodProcessor&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;pre style=&quot;&quot;&gt;internalEventListenerFactory            ---&amp;gt;DefaultEventListenerFactory&lt;/pre&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="1351" y="840" width="1219" height="460" as="geometry" />
        </mxCell>
        <mxCell id="3Tz9ayiB8aLOj15XIJGB-4" value="&lt;font style=&quot;font-size: 18px;&quot;&gt;parseCustomElement&lt;/font&gt;&lt;div style=&quot;font-size: 18px;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;()：包括但不限于以下标签：&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 18px;&quot;&gt;&lt;pre style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;context:component-scan、以及各种自定义的标签&lt;/font&gt;&lt;/pre&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="1930" y="524" width="420" height="120" as="geometry" />
        </mxCell>
        <mxCell id="wJDUlHO4tCs9Kh0-4UFC-3" value="&lt;b&gt;loadBeanDefinition方法重要的地方&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=23;" parent="1" vertex="1">
          <mxGeometry x="1731" y="440" width="419" height="20" as="geometry" />
        </mxCell>
        <mxCell id="wJDUlHO4tCs9Kh0-4UFC-4" value="&lt;font style=&quot;font-size: 18px;&quot;&gt;所以最后obtainFreshBeanFactory执行完成之后，BeanDefinition有2块内容：&lt;br&gt;1.是扫描包路径下自己定义的有对应注解的类，&lt;br&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;2.内部注册的一些组件类。&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1431" y="1320" width="680" height="90" as="geometry" />
        </mxCell>
        <mxCell id="gD5YT0Y3-eSmoMF3_J99-1" value="BeanPostProcessor接口的依赖关系是怎样的？" style="rounded=1;whiteSpace=wrap;html=1;fontSize=22;" parent="1" vertex="1">
          <mxGeometry x="2780" y="580" width="480" height="190" as="geometry" />
        </mxCell>
        <mxCell id="gD5YT0Y3-eSmoMF3_J99-4" value="FactoryBean的创建流程&lt;br&gt;&lt;br&gt;&lt;pre style=&quot;&quot;&gt;getObjectForBeanInstance：该方法主要是为了factorybean。&lt;/pre&gt;&lt;pre style=&quot;&quot;&gt;传入的对象有可能是FactoryBean对象，不是需要的实例对象。&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=22;align=left;" parent="1" vertex="1">
          <mxGeometry x="1320" y="2040" width="690" height="190" as="geometry" />
        </mxCell>
        <mxCell id="gD5YT0Y3-eSmoMF3_J99-5" value="三级缓存和循环依赖问题&lt;br&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=22;" parent="1" vertex="1">
          <mxGeometry x="1420" y="3260" width="440" height="140" as="geometry" />
        </mxCell>
        <mxCell id="gD5YT0Y3-eSmoMF3_J99-6" value="BPP如何实现 在doCreateBean()之前返回一个代理对象？" style="rounded=1;whiteSpace=wrap;html=1;fontSize=22;" parent="1" vertex="1">
          <mxGeometry x="1350" y="2260" width="550" height="150" as="geometry" />
        </mxCell>
        <mxCell id="gD5YT0Y3-eSmoMF3_J99-7" value="Spring中创建对象有哪些方式？&lt;br&gt;1.反射&lt;br&gt;2.supplier&lt;br&gt;3.factory-method&lt;br&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=22;" parent="1" vertex="1">
          <mxGeometry x="1341" y="2470" width="549" height="220" as="geometry" />
        </mxCell>
        <mxCell id="UeAGvA_bwLcHGkh69qGp-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="UeAGvA_bwLcHGkh69qGp-1" target="UeAGvA_bwLcHGkh69qGp-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="UeAGvA_bwLcHGkh69qGp-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="UeAGvA_bwLcHGkh69qGp-1" target="UeAGvA_bwLcHGkh69qGp-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="UeAGvA_bwLcHGkh69qGp-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="UeAGvA_bwLcHGkh69qGp-1" target="UeAGvA_bwLcHGkh69qGp-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="UeAGvA_bwLcHGkh69qGp-1" value="&lt;font style=&quot;font-size: 18px;&quot;&gt;BeanPostProcessor接口&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2640" y="1100" width="310" height="80" as="geometry" />
        </mxCell>
        <mxCell id="UeAGvA_bwLcHGkh69qGp-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="UeAGvA_bwLcHGkh69qGp-2" target="UeAGvA_bwLcHGkh69qGp-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="UeAGvA_bwLcHGkh69qGp-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="UeAGvA_bwLcHGkh69qGp-2" target="UeAGvA_bwLcHGkh69qGp-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="UeAGvA_bwLcHGkh69qGp-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.75;entryDx=0;entryDy=0;" parent="1" source="UeAGvA_bwLcHGkh69qGp-2" target="UeAGvA_bwLcHGkh69qGp-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="UeAGvA_bwLcHGkh69qGp-2" value="&lt;pre style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;InstantiationAwareBeanPostProcessor接口&lt;/font&gt;&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3170" y="1112" width="430" height="78" as="geometry" />
        </mxCell>
        <mxCell id="UeAGvA_bwLcHGkh69qGp-3" value="&lt;pre style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;DestructionAwareBeanPostProcessor接口&lt;/font&gt;&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3170" y="940" width="460" height="80" as="geometry" />
        </mxCell>
        <mxCell id="UeAGvA_bwLcHGkh69qGp-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="UeAGvA_bwLcHGkh69qGp-4" target="UeAGvA_bwLcHGkh69qGp-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="4430" y="1035" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="UeAGvA_bwLcHGkh69qGp-4" value="&lt;pre style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;SmartInstantiationAwareBeanPostProcessor接口&lt;/font&gt;&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3936" y="1000" width="514" height="70" as="geometry" />
        </mxCell>
        <mxCell id="UeAGvA_bwLcHGkh69qGp-5" value="&lt;pre style=&quot;&quot;&gt;&lt;pre style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;MergedBeanDefinitionPostProcessor接口&lt;/font&gt;&lt;/pre&gt;&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3170" y="1270" width="450" height="80" as="geometry" />
        </mxCell>
        <mxCell id="UeAGvA_bwLcHGkh69qGp-11" value="&lt;pre style=&quot;border-color: var(--border-color);&quot;&gt;&lt;font style=&quot;border-color: var(--border-color); font-size: 18px;&quot;&gt;ImportAwareBeanPostProcessor类&lt;/font&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3942" y="1100" width="508" height="50" as="geometry" />
        </mxCell>
        <mxCell id="UeAGvA_bwLcHGkh69qGp-12" value="&lt;pre style=&quot;border-color: var(--border-color);&quot;&gt;&lt;pre style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;CommonAnnotationBeanPostProcessor类&lt;/font&gt;&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3942" y="1170" width="508" height="40" as="geometry" />
        </mxCell>
        <mxCell id="UeAGvA_bwLcHGkh69qGp-13" value="&lt;pre style=&quot;border-color: var(--border-color);&quot;&gt;&lt;pre style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;AutowiredAnnotationBeanPostProcessor类&lt;/font&gt;&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4530" y="1010" width="520" height="50" as="geometry" />
        </mxCell>
        <mxCell id="MSwICJZJJ-8O9ppRQRhp-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="0R7P9N3aFObu-qyjlIBD-2" target="MSwICJZJJ-8O9ppRQRhp-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0R7P9N3aFObu-qyjlIBD-2" value="创建对象的时候，如何选取合适的构造函数？&lt;br&gt;以及lookup-method和override-method是在什么时候处理的呢？&lt;br&gt;&lt;br&gt;doCreateBean方法执行到createBeanInstance()那里，会先判断supplier和factory-method，然后determineConstructorsFromBeanPostProcessors()，从bean后置处理器中为自动装配寻找构造方法, &lt;b&gt;&lt;font style=&quot;font-size: 25px;&quot;&gt;有且仅有一个有参构造或者有且仅有@Autowired注解构造&lt;/font&gt;&lt;/b&gt;：&lt;br&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;首先找到实现了InstantiationAwareBeanPostProcessor的那些BPP实例，循环调用它们的determineCandidateConstructors()，返回的是一个构造器类，" style="rounded=1;whiteSpace=wrap;html=1;fontSize=22;align=left;" parent="1" vertex="1">
          <mxGeometry x="1370" y="2750" width="750" height="360" as="geometry" />
        </mxCell>
        <mxCell id="N0wu8gUbkJhDh__TXsF7-1" value="&lt;font style=&quot;font-size: 18px;&quot;&gt;applyMergedBeanDefinitionPostProcessors为什么要在实例化之后再调用呢？为什么不能在loadBeanDefinition的时候就一起处理了？&lt;br&gt;&lt;br&gt;&lt;font color=&quot;#ff0000&quot;&gt;中途会修改？具体的解释？&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2160" y="2400" width="410" height="240" as="geometry" />
        </mxCell>
        <mxCell id="MSwICJZJJ-8O9ppRQRhp-1" value="Spring 源码里面一共有几种方式创建对象？&lt;br&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=22;" vertex="1" parent="1">
          <mxGeometry x="1405.5" y="3450" width="440" height="140" as="geometry" />
        </mxCell>
        <mxCell id="MSwICJZJJ-8O9ppRQRhp-2" value="1.首先，如果只有一个有参构造(无Autowired)，且方法参数是基础类型，那么必须使用@Value给参数注解。否则会报错！因为注入的时候找不到参数值进行注入，如果是引用类型，则会再进行解析依赖，进行创建对象。" style="whiteSpace=wrap;html=1;fontSize=22;align=left;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="2275" y="2765" width="675" height="330" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
